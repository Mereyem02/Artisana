{% extends 'base.html.twig' %}

{% block title %}Nouveau Produit - Artisana.ma{% endblock %}

{% block stylesheets %}
    <link rel="stylesheet" href="{{ asset('css/product_form.css') }}">
{% endblock %}

{% block body %}
<div class="container product-form-container">
    <div class="page-header">
        <h1><i class="fas fa-plus-circle"></i> Ajouter un Produit</h1>
        <p>Créez un nouveau produit artisanal</p>
    </div>

    <div class="card">
        {{ form_start(form, {'attr': {'id': 'product-form', 'class': 'js-confirm-submit', 'novalidate': 'novalidate', 'enctype': 'multipart/form-data', 'data-title': 'Confirmer la création', 'data-text': 'Êtes-vous sûr de vouloir créer ce produit ?', 'data-confirm-button': 'Oui, créer'}}) }}
            {{ form_errors(form) }}
            <div class="product-form-grid">
                <div class="form-group">
                    {{ form_label(form.titre, null, {'label_attr': {'class': 'form-label'}}) }}
                    {% set titre_attr = {'class': 'form-control'} %}
                    {% if not form.titre.vars.valid %}{% set titre_attr = titre_attr|merge({'class': titre_attr.class ~ ' is-invalid'}) %}{% endif %}
                    {{ form_widget(form.titre, {'attr': titre_attr}) }}
                    {% if not form.titre.vars.valid %}<div class="error-message">{{ form_errors(form.titre) }}</div>{% endif %}
                </div>

                <div class="form-group">
                    {{ form_label(form.description, null, {'label_attr': {'class': 'form-label'}}) }}
                    {% set desc_attr = {'class': 'form-control'} %}
                    {% if not form.description.vars.valid %}{% set desc_attr = desc_attr|merge({'class': desc_attr.class ~ ' is-invalid'}) %}{% endif %}
                    {{ form_widget(form.description, {'attr': desc_attr}) }}
                    {% if not form.description.vars.valid %}<div class="error-message">{{ form_errors(form.description) }}</div>{% endif %}
                </div>

                <div class="product-form-row">
                    <div class="form-group">
                        {{ form_label(form.prix, null, {'label_attr': {'class': 'form-label'}}) }}
                        {% set prix_attr = {'class': 'form-control'} %}
                        {% if not form.prix.vars.valid %}{% set prix_attr = prix_attr|merge({'class': prix_attr.class ~ ' is-invalid'}) %}{% endif %}
                        {{ form_widget(form.prix, {'attr': prix_attr}) }}
                        {% if not form.prix.vars.valid %}<div class="error-message">{{ form_errors(form.prix) }}</div>{% endif %}
                    </div>

                    <div class="form-group">
                        {{ form_label(form.stock) }}
                        {% set stock_attr = {'class': 'form-control'} %}
                        {% if not form.stock.vars.valid %}{% set stock_attr = stock_attr|merge({'class': stock_attr.class ~ ' is-invalid'}) %}{% endif %}
                        {{ form_widget(form.stock, {'attr': stock_attr}) }}
                        {% if not form.stock.vars.valid %}<div class="error-message"> {{ form_errors(form.stock) }}</div>{% endif %}
                    </div>
                </div>

                <div class="form-group">
                    {{ form_label(form.dimensions, null, {'label_attr': {'class': 'form-label'}}) }}
                    {% set dim_attr = {'class': 'form-control'} %}
                    {% if not form.dimensions.vars.valid %}{% set dim_attr = dim_attr|merge({'class': dim_attr.class ~ ' is-invalid'}) %}{% endif %}
                    {{ form_widget(form.dimensions, {'attr': dim_attr}) }}
                   {% if not form.dimensions.vars.valid %}<div class="error-message"> {{ form_errors(form.dimensions) }}</div>{% endif %}
                </div>

                <div class="form-group">
                    {{ form_label(form.materiaux) }}
                    <div id="materiaux-list" data-prototype="{{ form_widget(form.materiaux.vars.prototype)|e('html_attr') }}">
                        {% for materiau in form.materiaux %}
                            <div class="materiau-item">
                                {{ form_widget(materiau) }}
                            </div>
                        {% endfor %}
                    </div>
                    <button type="button" class="btn btn-secondary mt-2" onclick="addMateriau()">
                        <i class="fas fa-plus"></i> Ajouter un matériau
                    </button>
                    {% if not form.materiaux.vars.valid %}<div class="error-message">{{ form_errors(form.materiaux) }}</div>{% endif %}
                </div>

                {% if form.cooperative is defined %}
                <div class="form-group">
                    {{ form_label(form.cooperative) }}
                    {% set coop_attr = {'class': 'form-control'} %}
                    {% if not form.cooperative.vars.valid %}{% set coop_attr = coop_attr|merge({'class': coop_attr.class ~ ' is-invalid'}) %}{% endif %}
                    {{ form_widget(form.cooperative, {'attr': coop_attr}) }}
                    {% if not form.cooperative.vars.valid %}<div class="error-message">{{ form_errors(form.cooperative) }}</div>{% endif %}
                </div>
                {% endif %}

                {% if form.artisans is defined %}
                <div class="form-group">
                    {{ form_label(form.artisans) }}
                    {% set arts_attr = {'class': 'form-control'} %}
                    {% if not form.artisans.vars.valid %}{% set arts_attr = arts_attr|merge({'class': arts_attr.class ~ ' is-invalid'}) %}{% endif %}
                    {{ form_widget(form.artisans, {'attr': arts_attr}) }}
                    {% if not form.artisans.vars.valid %}<div class="error-message">{{ form_errors(form.artisans) }}</div>{% endif %}
                </div>
                {% endif %}

                <div class="product-form-checkbox-group">
                    {{ form_widget(form.isActive) }}
                    {{ form_label(form.isActive) }}
                    {% if not form.isActive.vars.valid %}<div class="error-message">{{ form_errors(form.isActive) }}</div>{% endif %}
                </div>

                <div class="form-group">
                    {{ form_label(form.photos) }}
                    {% set photos_attr = {'class': 'form-control'} %}
                    {% if not form.photos.vars.valid %}{% set photos_attr = photos_attr|merge({'class': photos_attr.class ~ ' is-invalid'}) %}{% endif %}
                    {{ form_widget(form.photos, {'attr': photos_attr}) }}
                    {% if not form.photos.vars.valid %}<div class="error-message">{{ form_errors(form.photos) }}</div>{% endif %}
                </div>

                <div class="product-form-actions">
                    <a href="/product" class="btn btn-secondary">
                        <i class="fas fa-times"></i> Annuler
                    </a>
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-save"></i> Enregistrer
                    </button>
                </div>
            </div>
        {{ form_end(form) }}
    </div>
</div>

{% endblock %}

{% block javascripts %}
    {{ parent() }}
    <script src="{{ asset('js/product_form.js') }}"></script>
{% endblock %}
